INFO:api_fisc_internal:Received pipeline trigger for job: 090510f4-a4f6-4150-a539-9974929eea44
INFO:     10.30.120.147:52518 - "POST /pipeline/run HTTP/1.1" 200 OK
INFO:pipeline_worker:Starting pipeline for Job ID: 090510f4-a4f6-4150-a539-9974929eea44
INFO:pipeline_worker:[pipeline] Running script: convert_documents.py
INFO:pipeline_worker:[convert_documents.py] stdout:
2026-02-06 08:51:22,783 - Prosei-test - INFO - (logging_config.py:49) - Logger setup complete.
2026-02-06 08:51:22,783 - Prosei-test - INFO - (convert_documents.py:139) - --- Document Conversion Script Started ---
2026-02-06 08:51:22,785 - Prosei-test - INFO - (convert_documents.py:51) - Loading configuration from: /nethome/prosei_d/Prosei/prosei-api-fiscalizacion/configs/convert_config.json
2026-02-06 08:51:22,786 - Prosei-test - INFO - (convert_documents.py:71) - Instantiating converter: DoclingJsonTablesExporter with parameters: {'do_ocr': True, 'do_table_structure': True, 'do_cell_matching': True}
2026-02-06 08:51:22,796 - Prosei-test - INFO - (convert_documents.py:166) - Input directory set to: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/raw
2026-02-06 08:51:22,796 - Prosei-test - INFO - (convert_documents.py:167) - Output directory set to: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/processed
2026-02-06 08:51:22,799 - Prosei-test - INFO - (convert_documents.py:95) - Found 1 PDF(s) to process.
2026-02-06 08:51:22,800 - Prosei-test - INFO - (converters.py:143) - Starting Docling JSON+tables conversion for: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/raw/input.pdf
2026-02-06 08:51:24,523 - Prosei-test - WARNING - (converters.py:148) - Docling table-structure backend unavailable (libgthread-2.0.so.0: cannot open shared object file: No such file or directory). Rebuilding converter without table_structure/cell_matching.
2026-02-06 08:51:30,379 - Prosei-test - INFO - (base_converter.py:46) - Successfully saved Markdown to /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/processed/input.txt
2026-02-06 08:51:30,393 - Prosei-test - INFO - (convert_documents.py:118) - --- Processing Summary ---
2026-02-06 08:51:30,393 - Prosei-test - INFO - (convert_documents.py:119) - Successfully converted: 1
2026-02-06 08:51:30,393 - Prosei-test - INFO - (convert_documents.py:120) - Failed to convert:    0
2026-02-06 08:51:30,394 - Prosei-test - INFO - (convert_documents.py:121) - Total files:           1
2026-02-06 08:51:30,395 - Prosei-test - INFO - (converters.py:321) - No tables were collected; skipping tables_index.json
2026-02-06 08:51:30,395 - Prosei-test - INFO - (convert_documents.py:170) - --- Document Conversion Script Finished ---

WARNING:pipeline_worker:[convert_documents.py] stderr:
/nethome/prosei_d/Prosei/prosei-api-fiscalizacion/venv/lib/python3.10/site-packages/pydantic/main.py:464: UserWarning: Pydantic serializer warnings:
  PydanticSerializationUnexpectedValue(Expected `list[str]` - serialized value may not be as expected [field_name='lang', input_value=('pt', 'en'), input_type=tuple])
  return self.__pydantic_serializer__.to_python(
No OCR engine found. Please review the install details.
No OCR engine found. Please review the install details.
-> Cannot close object, library is destroyed. This may cause a memory leak!

INFO:pipeline_worker:[pipeline] Stage 'conversion' finished in 19.22 seconds
INFO:pipeline_worker:[pipeline] Running script: preprocess_texts.py
INFO:pipeline_worker:[preprocess_texts.py] stdout:
2026-02-06 08:51:31,592 - Prosei-test - INFO - (logging_config.py:49) - Logger setup complete.
2026-02-06 08:51:31,592 - Prosei-test - INFO - (preprocess_texts.py:88) - --- Text Preprocessing Script Started ---
2026-02-06 08:51:31,594 - Prosei-test - INFO - (preprocess_texts.py:40) - Loading configuration from: /nethome/prosei_d/Prosei/prosei-api-fiscalizacion/configs/preprocess_config.json
2026-02-06 08:51:31,595 - Prosei-test - INFO - (preprocess_texts.py:114) - Input directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/processed
2026-02-06 08:51:31,595 - Prosei-test - INFO - (preprocess_texts.py:115) - Output directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/cleaned
2026-02-06 08:51:31,595 - Prosei-test - INFO - (preprocess_texts.py:116) - Enabled steps: ['remove_excessive_line_breaks', 'to_lowercase']
2026-02-06 08:51:31,598 - Prosei-test - INFO - (preprocess_texts.py:61) - Found 1 file(s) to process.
2026-02-06 08:51:31,603 - Prosei-test - INFO - (preprocess_texts.py:79) - --- Preprocessing Summary ---
2026-02-06 08:51:31,603 - Prosei-test - INFO - (preprocess_texts.py:80) - Processed 1 files.
2026-02-06 08:51:31,604 - Prosei-test - INFO - (preprocess_texts.py:120) - --- Text Preprocessing Script Finished ---

INFO:pipeline_worker:[pipeline] Stage 'preprocessing' finished in 0.08 seconds
INFO:pipeline_worker:[pipeline] Running script: segment_documents.py
INFO:pipeline_worker:[segment_documents.py] stdout:
2026-02-06 08:51:32,579 - Prosei-test - INFO - (logging_config.py:49) - Logger setup complete.
2026-02-06 08:51:32,579 - Prosei-test - INFO - (segment_documents.py:177) - --- Document Segmentation Script Started ---
2026-02-06 08:51:32,581 - Prosei-test - INFO - (segment_documents.py:56) - Loading configuration from: /nethome/prosei_d/Prosei/prosei-api-fiscalizacion/configs/segment_config.json
2026-02-06 08:51:32,582 - Prosei-test - INFO - (segment_documents.py:102) - Instantiating splitter: rules
2026-02-06 08:51:32,582 - Prosei-test - INFO - (segment_documents.py:206) - Input directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/cleaned
2026-02-06 08:51:32,582 - Prosei-test - INFO - (segment_documents.py:207) - Output directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/segmented
2026-02-06 08:51:32,584 - Prosei-test - INFO - (segment_documents.py:131) - Found 1 file(s) to segment.
2026-02-06 08:51:32,589 - Prosei-test - INFO - (segment_documents.py:168) - --- Segmentation Summary ---
2026-02-06 08:51:32,589 - Prosei-test - INFO - (segment_documents.py:169) - Processed 1 files.
2026-02-06 08:51:32,590 - Prosei-test - INFO - (segment_documents.py:212) - --- Document Segmentation Script Finished ---

INFO:pipeline_worker:[pipeline] Stage 'segmenting' finished in 1.03 seconds
INFO:pipeline_worker:[pipeline] Running script: tag_blocks.py
INFO:pipeline_worker:[tag_blocks.py] stdout:
2026-02-06 08:51:33,427 - Prosei-test - INFO - (logging_config.py:49) - Logger setup complete.
2026-02-06 08:51:33,427 - Prosei-test - INFO - (tag_blocks.py:143) - --- Document Tagging Script Started ---
2026-02-06 08:51:33,429 - Prosei-test - INFO - (tag_blocks.py:49) - Loading Azure credentials for BlockTagger...
2026-02-06 08:51:33,429 - Prosei-test - INFO - (tag_blocks.py:64) - Instantiating BlockTagger for endpoint: https://apit.petrobras.com.br/ia/openai/v1/openai-azure
2026-02-06 08:51:33,492 - Prosei-test - INFO - (tag_blocks.py:164) - Input directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/segmented
2026-02-06 08:51:33,492 - Prosei-test - INFO - (tag_blocks.py:165) - Output directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/tagged
2026-02-06 08:51:33,495 - Prosei-test - INFO - (tag_blocks.py:90) - Found 1 file(s) to tag.
2026-02-06 08:51:33,496 - Prosei-test - INFO - (tag_blocks.py:103) - Tagging 37 blocks for page_1...
2026-02-06 08:52:31,298 - Prosei-test - INFO - (tag_blocks.py:134) - --- Tagging Summary ---
2026-02-06 08:52:31,298 - Prosei-test - INFO - (tag_blocks.py:135) - Processed 1 files.
2026-02-06 08:52:31,299 - Prosei-test - INFO - (tag_blocks.py:170) - --- Document Tagging Script Finished ---

INFO:pipeline_worker:[pipeline] Stage 'tagging' finished in 58.75 seconds
INFO:pipeline_worker:[pipeline] Running script: verify_documents.py
INFO:pipeline_worker:[verify_documents.py] stdout:
2026-02-06 08:52:32,385 - Prosei-test - INFO - (logging_config.py:49) - Logger setup complete.
2026-02-06 08:52:32,385 - Prosei-test - INFO - (verify_documents.py:223) - --- Document Verification Script Started ---
2026-02-06 08:52:32,386 - Prosei-test - INFO - (verify_documents.py:42) - Loading configuration from: /nethome/prosei_d/Prosei/prosei-api-fiscalizacion/configs/verify_config.json
2026-02-06 08:52:32,387 - Prosei-test - INFO - (verification_loader.py:30) - Loading verification rules from: /nethome/prosei_d/Prosei/prosei-api-fiscalizacion/configs/rules_lista_cargas.json
2026-02-06 08:52:32,387 - Prosei-test - INFO - (verification_loader.py:44) - Successfully loaded 25 rules for 'Lista de Cargas'.
2026-02-06 08:52:32,387 - Prosei-test - INFO - (verify_documents.py:49) - Loading Azure credentials for DocumentVerifier...
2026-02-06 08:52:32,388 - Prosei-test - INFO - (verify_documents.py:64) - Instantiating DocumentVerifier for endpoint: https://apit.petrobras.com.br/ia/openai/v1/openai-azure
2026-02-06 08:52:32,436 - Prosei-test - INFO - (verify_documents.py:253) - Input directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/tagged
2026-02-06 08:52:32,436 - Prosei-test - INFO - (verify_documents.py:254) - Output directory: /nethome/prosei_d/Prosei/shared_data/jobs/090510f4-a4f6-4150-a539-9974929eea44/verification_reports
2026-02-06 08:52:32,437 - Prosei-test - INFO - (verify_documents.py:255) - Document type: lista_cargas (25 rules loaded)
2026-02-06 08:52:32,439 - Prosei-test - INFO - (verify_documents.py:193) - Found 1 file(s) to verify.
2026-02-06 08:53:20,022 - Prosei-test - INFO - (verify_documents.py:216) - --- Verification Summary ---
2026-02-06 08:53:20,022 - Prosei-test - INFO - (verify_documents.py:217) - Processed 1 files.
2026-02-06 08:53:20,023 - Prosei-test - INFO - (verify_documents.py:259) - --- Document Verification Script Finished ---

INFO:pipeline_worker:[pipeline] Stage 'verifying' finished in 48.73 seconds
INFO:pipeline_worker:Pipeline finished successfully for 090510f4-a4f6-4150-a539-9974929eea44 in 127.84 seconds
